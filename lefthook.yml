# Lefthook configuration
# https://lefthook.dev/

pre-commit:
  parallel: true
  jobs:
    - name: biome check
      run: pnpm biome check --write --no-errors-on-unmatched --files-ignore-unknown=true {staged_files}
      stage_fixed: true
      glob: "*.{js,ts,tsx,jsx,json,jsonc}"

    - name: type-check
      run: pnpm type-check
      glob: "*.{ts,tsx}"

commit-msg:
  jobs:
    - name: conventional commit
      run: |
        commit_msg=$(cat {1})
        pattern="^(feat|fix|docs|style|refactor|perf|test|build|ci|chore|revert)(\(.+\))?: .{1,}"
        if ! echo "$commit_msg" | grep -qE "$pattern"; then
          echo "‚ùå Invalid commit message format!"
          echo ""
          echo "Commit message must follow Conventional Commits:"
          echo "  <type>(<scope>): <description>"
          echo ""
          echo "Types: feat, fix, docs, style, refactor, perf, test, build, ci, chore, revert"
          echo ""
          echo "Examples:"
          echo "  feat(auth): add OAuth support"
          echo "  fix(db): resolve connection pooling issue"
          echo "  docs: update README"
          exit 1
        fi

pre-push:
  parallel: true
  jobs:
    - name: lint
      run: pnpm lint

    - name: type-check
      run: pnpm type-check

